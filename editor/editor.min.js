/**
 * Copyright (c) 2014 by Jamie Peabody, http://www.mergely.com
 * All rights reserved.
 * Version: 3.3.6 2014-01-25
 */
$(document).ready(function(){function a(){var a={};return window.location.search.substr(1).split("&").forEach(function(b){if(""!==b){var c=b.split("=");a[c[0]]="true"==c[1]?!0:"false"==c[1]?!1:c[1]&&decodeURIComponent(c[1].replace(/\+/g," "))}}),{get:function(b,c){return a.hasOwnProperty(b)?a[b]:c}}}function f(a){if(!a.length)return!1;var b=$("#mergely"),c=a.find(".find"),d=c.find('input[type="text"]'),e=a.attr("id").indexOf("-lhs")>0?"lhs":"rhs",f=b.mergely("options").autoupdate;c.slideDown("fast",function(){d.focus(),b.mergely("options",{autoupdate:!1}),b.mergely("unmarkup")}),c.find(".find-prev").click(function(){b.mergely("search",e,d.val(),"prev")}),c.find(".find-next").click(function(){b.mergely("search",e,d.val(),"next")}),c.find(".find-close").click(function(){c.css("display","none"),b.mergely("options",{autoupdate:f})}),d.keydown(function(a){return 13!=a.which&&27!=a.which?!0:(27==a.which&&(c.css("display","none"),b.mergely("options",{autoupdate:f})),b.mergely("search",e,d.val()),!1)})}function p(a){if("file-new"==a)window.location="/editor";else if("file-save"==a){var b=g.mergely("diff");if(-1===navigator.userAgent.toLowerCase().indexOf("msie")){""==key&&(key="".random(8));var c=jQuery("<a />",{href:"data:application/stream;base64,"+window.btoa(unescape(encodeURIComponent(b))),target:"_blank",text:"clickme",id:key});c.attr("download",key+".diff"),jQuery("body").append(c);var d=$("a#"+key);d[0].click(),d.remove()}else{var e=new Blob([b]);window.navigator.msSaveOrOpenBlob(e,key+".diff")}}else if("file-share"==a)q(g);else if("file-import"==a)s(g);else if("edit-left-undo"==a)g.mergely("cm","lhs").getDoc().undo();else if("edit-left-redo"==a)g.mergely("cm","lhs").getDoc().redo();else if("edit-right-undo"==a)g.mergely("cm","rhs").getDoc().undo();else if("edit-right-redo"==a)g.mergely("cm","rhs").getDoc().redo();else if("edit-left-find"==a)f(g.find("#mergely-editor-lhs"));else if("edit-left-merge-right"==a)g.mergely("merge","rhs");else if(["edit-left-readonly","edit-right-readonly","options-autodiff","options-sidebars","options-swapmargin","options-viewport","options-ignorews","options-wrap","options-linenumbers"].indexOf(a)>=0)n[a].set(!n[a].get()),h.wickedmenu("update",a);else if("edit-left-clear"==a)g.mergely("clear","lhs");else if("edit-right-find"==a)f(g.find("#mergely-editor-rhs"));else if("edit-right-merge-left"==a)g.mergely("merge","lhs");else if("edit-right-clear"==a)g.mergely("clear","rhs");else if("options-colors"==a)t(g);else if("view-swap"==a)g.mergely("swap");else if("view-refresh"==a)g.mergely("update");else if("view-clear"==a)g.mergely("unmarkup");else if(0==a.indexOf("examples-")){var i={test1:{lhs:"one\ntwo\nthree",rhs:"two\nthree"},test2:{lhs:"two\nthree",rhs:"one\ntwo\nthree"},test3:{lhs:"one\nthree",rhs:"one\ntwo\nthree"},test4:{lhs:"one\ntwo\nthree",rhs:"one\nthree"},test5:{lhs:"to bee, or not to be",rhs:"to be, or not to bee"},test6:{lhs:"to be, or not to be z",rhs:"to be, to be"},test7:{lhs:"remained, & to assume",rhs:"and to assume"},test8:{lhs:"to be, or not to be",rhs:"to  be,  or  not  to  be"}},j=a.split("examples-")[1];g.mergely("lhs",i[j].lhs),g.mergely("rhs",i[j].rhs)}return!1}function q(a){function d(a,d){$.ajax({type:"POST",async:!0,dataType:"text",url:"/ajax/handle_file.php",data:{key:key,name:a,content:d},success:function(){if(++c,2==c){var d="/ajax/handle_save.php?key="+key;b&&(d+="&nkey="+"".random(8)),$.ajax({type:"GET",async:!1,dataType:"text",url:d,success:function(a){a.length&&(window.location.href="/"+$.trim(a)+"/")},error:function(){}})}},error:function(a,b,c){alert(c)}})}function e(){var b=a.mergely("get","lhs"),c=a.mergely("get","rhs");d("lhs",b),d("rhs",c)}var b="fork"==$(this).attr("id");""==key&&(key="".random(8));var c=0;$("#dialog-confirm").dialog({resizable:!1,width:350,modal:!0,buttons:{"Save for Sharing":function(){$(this).dialog("close"),e()},Cancel:function(){$(this).dialog("close")}}})}function r(a,b,c){$.ajax({type:"GET",dataType:"text",data:{url:c},url:"/ajax/handle_crossdomain.php",contentType:"text/plain",success:function(c){a.mergely(b,c)},error:function(a,b,c){console.error("error",a,b,c)}})}function s(a){function b(a){function f(a,b){e.trigger(a,b)}var c=a.files[0],d=new FileReader,e=$(a);d.onloadstart=function(){f("start")},d.onprogress=function(a){f("progress",a)},d.onload=function(a){f("loaded",a.target.result)},d.onerror=function(a){alert(a.target.error.name)};try{d.readAsText(c,"UTF-8")}catch(g){console.error(g),alert(g)}}var c={};$("#file-lhs, #file-rhs").change(function(a){var d=new RegExp(".*[\\\\/](.*)$"),e=d.exec($(this).val()),f=e?e[1]:"unknown",g=$("#"+a.target.id+"-progress");b(a.target),$(a.target).bind("start",function(){$(a.target).css("display","none"),g.css("display","inline-block")}),$(a.target).bind("progress",function(a,b){var c=100*(b.loaded/b.total);g.find("> .progress-label").text(c+"%"),g.progressbar("value",c)}),$(a.target).bind("loaded",function(b,d){g.progressbar("value",100),g.find("> .progress-label").text(f),c[a.target.id]=d})}),$("#file-lhs-progress").progressbar({value:0}),$("#file-rhs-progress").progressbar({value:0}),$("#dialog-upload .tabs").tabs(),$("#dialog-upload").dialog({dialogClass:"no-title",resizable:!1,width:"450px",modal:!0,buttons:{Import:function(){$(this).dialog("close");var b={lhs:$("#url-lhs").val(),rhs:$("#url-rhs").val()};for(var d in b){var e=b[d];e&&r(a,d,e)}c.hasOwnProperty("file-lhs")&&a.mergely("lhs",c["file-lhs"]),c.hasOwnProperty("file-rhs")&&a.mergely("rhs",c["file-rhs"])},Cancel:function(){$(this).dialog("close")}}})}function t(a){var b=$('<span style="display:none" class="mergely ch d lhs">C</span>'),c=$('<span style="display:none" class="mergely bg a rhs start end">C</span>'),d=$('<span style="display:none" class="mergely c rhs start end">C</span>');$("body").append(b),$("body").append(c),$("body").append(d);var e={"c-border":{id:"#c-border",defaultColor:"#cccccc",getColor:function(){return d.css("border-top-color")},setColor:function(a){$("#"+this.id).val(a)}},"c-bg":{id:"#c-bg",defaultColor:"#fafafa",getColor:function(){return d.css("background-color")},setColor:function(a){$("#"+this.id).val(a)}},"a-border":{id:"#a-border",defaultColor:"#a3d1ff",getColor:function(){return c.css("border-top-color")},setColor:function(a){$("#"+this.id).val(a)}},"a-bg":{id:"#a-bg",defaultColor:"#ddeeff",getColor:function(){return c.css("background-color")},setColor:function(a){$("#"+this.id).val(a)}},"d-border":{id:"#d-border",defaultColor:"#ff7f7f",getColor:function(){return b.css("border-top-color")},setColor:function(a){$("#"+this.id).val(a)}},"d-bg":{id:"#d-bg",defaultColor:"#edc0c0",getColor:function(){return b.css("background-color")},setColor:function(a){$("#"+this.id).val(a)}}};$.each(e,function(a,b){$(b.id).val(b.getColor())});var f=$.farbtastic("#picker");$(".colorwell").each(function(){f.linkTo(this)}).focus(function(){var a=$(this);f.linkTo(this);var b=e[a.attr("id")];f.setColor(b.getColor())}),$("#dialog-colors").dialog({width:490,modal:!0,buttons:{Apply:function(){var b=$("#c-border").val(),c=$("#a-border").val(),d=$("#d-border").val(),e=$("#a-bg").val(),f=$("#d-bg").val(),g=$("#c-bg").val(),h=".mergely.a.rhs.start { border-top: 1px solid "+c+"; }\n						.mergely.a.lhs.start.end,\n						.mergely.a.rhs.end { border-bottom: 1px solid "+c+"; }\n						.mergely.a.rhs { background-color: "+e+"; }\n						.mergely.d.lhs { background-color: "+f+"; }\n						.mergely.d.lhs.end,\n						.mergely.d.rhs.start.end { border-bottom: 1px solid "+d+"; }\n						.mergely.d.rhs.start.end.first { border-bottom: 0; border-top: 1px solid "+d+"; }\n						.mergely.d.lhs.start { border-top: 1px solid "+d+"; }\n						.mergely.c.lhs,\n						.mergely.c.rhs { background-color: "+g+"; }\n						.mergely.c.lhs.start,\n						.mergely.c.rhs.start { border-top: 1px solid "+b+"; }\n						.mergely.c.lhs.end,\n						.mergely.c.rhs.end { border-bottom: 1px solid "+b+"; }\n						.mergely.ch.a.rhs { background-color: "+e+"; }\n						.mergely.ch.d.lhs { background-color: "+f+"; text-decoration: line-through; color: #888; }";$('<style type="text/css">'+h+"</style>").appendTo("head"),a.mergely("options",{fgcolor:{a:c,c:b,d:d}})},Reset:function(){},Close:function(){$(this).dialog("close")}}})}var b=a();if(b.get("test",!1)){for(var c=$("<li>Tests</li>"),d=$("<ul>"),e=1;8>=e;++e)d.append($('<li id="examples-test'+e+'">Test '+e+"</li>"));c.append(d),$("#main-menu").append(c)}$(document).keydown(function(a){if("f"!=String.fromCharCode(a.which).toLowerCase()||!a.ctrlKey)return!0;a.preventDefault();var b=window.getSelection().getRangeAt(0),c=$(b.commonAncestorContainer).parents(".mergely-column");return f(c),!1}),String.prototype.random=function(a){for(var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",c="",d=0;a>d;d++){var e=Math.floor(Math.random()*b.length);c+=b.substring(e,e+1)}return c};var g=$("#mergely"),h=$("#main-menu"),i=$("#toolbar");if(g.mergely({width:"auto",height:"auto",cmsettings:{lineNumbers:!0,readOnly:isSample}}),b.get("lhs",null)){var j=b.get("lhs");r(g,"lhs",j)}if(b.get("rhs",null)){var j=b.get("rhs");r(g,"rhs",j)}8==key.length&&$.when($.ajax({type:"GET",async:!0,dataType:"text",data:{key:key,name:"lhs"},url:"/ajax/handle_get.php",success:function(a){g.mergely("lhs",a)},error:function(){}}),$.ajax({type:"GET",async:!0,dataType:"text",data:{key:key,name:"rhs"},url:"/ajax/handle_get.php",success:function(a){g.mergely("rhs",a)},error:function(){}})).done(function(){var a=window.location.hash.substring(1);if(a){var b=a.match(/([lr]hs)([0-9]+)/);3==b.length&&(console.log(b),g.mergely("scrollTo",b[1],parseInt(b[2],10)))}});var k=$(".find"),l=k.clone().attr("id","mergely-editor-lhs-find"),m=k.clone().attr("id","mergely-editor-rhs-find");$("#mergely-editor-lhs").append(l),$("#mergely-editor-rhs").append(m),k.remove();var n={"options-autodiff":{get:function(){return g.mergely("options").autoupdate},set:function(){g.mergely("options",{autoupdate:!g.mergely("options").autoupdate})}},"options-ignorews":{get:function(){return g.mergely("options").ignorews},set:function(){g.mergely("options",{ignorews:!g.mergely("options").ignorews})}},"options-sidebars":{get:function(){return console.log("sidebar",this),g.mergely("options").sidebar},set:function(){g.mergely("options",{sidebar:!g.mergely("options").sidebar})}},"options-viewport":{get:function(){return console.log("viewport",this),g.mergely("options").viewport},set:function(){g.mergely("options",{viewport:!g.mergely("options").viewport})}},"options-swapmargin":{get:function(){return"left"==g.mergely("options").rhs_margin},set:function(){g.mergely("options",{rhs_margin:"left"==g.mergely("options").rhs_margin?"right":"left"})}},"options-linenumbers":{get:function(){return g.mergely("cm","lhs").getOption("lineNumbers")},set:function(a){g.mergely("cm","lhs").setOption("lineNumbers",a),g.mergely("cm","rhs").setOption("lineNumbers",a)}},"options-wrap":{get:function(){return g.mergely("cm","lhs").getOption("lineWrapping")},set:function(a){g.mergely("cm","lhs").setOption("lineWrapping",a),g.mergely("cm","rhs").setOption("lineWrapping",a)}},"edit-left-readonly":{get:function(){return g.mergely("cm","lhs").getOption("readOnly")},set:function(a){g.mergely("cm","lhs").setOption("readOnly",a)}},"edit-right-readonly":{get:function(){return g.mergely("cm","rhs").getOption("readOnly")},set:function(a){g.mergely("cm","rhs").setOption("readOnly",a)}}},o={hasIcon:function(a){return n.hasOwnProperty(a)},getIcon:function(a){return n[a].get()?"icon-check":void 0}};h.wickedmenu(o).bind("selected",function(a,b){return p(b)}),i.wickedtoolbar({}).bind("selected",function(a,b){return b?p(b.replace(/^tb-/,"")):!1}),i.find("li[title]").tipsy({opacity:1}),h.find("li[title]").tipsy({opacity:1,delayIn:1e3,gravity:"w"})});